<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Dashboard | XMind2TestCase</title>
    <link rel="shortcut icon" href="{{ url_for('static',path='favicon.ico') }}" type="image/x-icon"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap">
    <link rel="stylesheet" type="text/css" media="all" href="{{ url_for('static',path='css/style.css') }}">
    <script src="{{ url_for('static',path='js/pagination.js') }}" defer></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="brand">
                <h1>X2T</h1>
            </div>
            <nav>
                <a href="{{ url_for('index') }}" class="nav-item active">
                    <span class="icon">ğŸ </span> é¦–é¡µä»ªè¡¨ç›˜
                </a>
                <a href="{{ url_for('manage_projects') }}" class="nav-item">
                    <span class="icon">ğŸ“‚</span> é¡¹ç›®ç®¡ç†
                </a>
                <a href="{{ url_for('manage_configs') }}" class="nav-item">
                    <span class="icon">âš™ï¸</span> ç³»ç»Ÿé…ç½®
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <h2>é¦–é¡µä»ªè¡¨ç›˜</h2>
            </header>

            <div class="content-wrapper">
                
                <!-- Statistics Dashboard -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“Š</div>
                        <div class="stat-content">
                            <div class="stat-value">{{ stats.today_count if stats else 0 }}</div>
                            <div class="stat-label">ä»Šæ—¥è½¬æ¢</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“…</div>
                        <div class="stat-content">
                            <div class="stat-value">{{ stats.week_count if stats else 0 }}</div>
                            <div class="stat-label">æœ¬å‘¨è½¬æ¢</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">âœ…</div>
                        <div class="stat-content">
                            <div class="stat-value">{{ stats.total_records if stats else 0 }}</div>
                            <div class="stat-label">æ€»è½¬æ¢æ•°</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">ğŸ“‚</div>
                        <div class="stat-content">
                            <div class="stat-value">{{ projects|length }}</div>
                            <div class="stat-label">é¡¹ç›®æ•°é‡</div>
                        </div>
                    </div>
                </div>
                
                <!-- Integrated Premium Upload Card -->
                <div class="card" style="padding: 2.5rem; border-radius: 20px; border: 1px solid var(--card-border); background: #ffffff; box-shadow: 0 10px 40px -10px rgba(0,0,0,0.05); transition: transform 0.3s ease;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 2.5rem;">
                         <h3 style="margin: 0; border: none; padding: 0; font-size: 1.5rem; font-weight: 700; color: #1e293b; display: flex; align-items: center; gap: 0.75rem;">
                            <span style="background: var(--primary-color); color: white; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 10px; font-size: 1.1rem; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);">1</span>
                            è½¬æ¢é…ç½®
                        </h3>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <button class="btn-guide" onclick="openGuideModal()" style="padding: 0.6rem 1.2rem; font-size: 0.9rem; border-radius: 8px; box-shadow: none; background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0;">
                                ğŸ“– ç¼–å†™è§„èŒƒ
                            </button>
                            <a href="{{ url_for('static', path='guide/XMindæµ‹è¯•ç”¨ä¾‹æ¨¡æ¿.xmind') }}" download="XMindæµ‹è¯•ç”¨ä¾‹æ¨¡æ¿.xmind" style="font-size: 0.85rem; color: var(--primary-color); text-decoration: none; display: flex; align-items: center; gap: 0.25rem; font-weight: 600; background: #eff6ff; padding: 0.5rem 1rem; border-radius: 8px; border: 1px solid #dbeafe;">
                                ğŸ“¥ ä¸‹è½½æ¨¡æ¿
                            </a>
                        </div>
                    </div>

                    <form method="post" enctype="multipart/form-data" class="upload-form">
                        <div class="upload-form-grid">
                            <!-- Left Side: Config -->
                            <div style="display: flex; flex-direction: column; gap: 1.75rem;">
                                <div class="form-group">
                                    <label for="project_id" style="display:block; margin-bottom: 0.6rem; color: #334155; font-weight: 600; font-size: 0.95rem;">
                                        æ‰€å±é¡¹ç›® <span style="color: #ef4444;">*</span>
                                    </label>
                                    <select name="project_id" id="project_id" class="input-modern" style="height: 50px; border-radius: 12px;" required>
                                        <option value="" disabled selected>-- è¯·é€‰æ‹©ç›®æ ‡é¡¹ç›® --</option>
                                        {% for project in projects %}
                                            <option value="{{ project.id }}">{{ project.name }}</option>
                                        {% endfor %}
                                    </select>
                                    {% if not projects %}
                                        <div style="margin-top: 0.5rem; color: #ef4444; font-size: 0.85em; display: flex; align-items: center; gap: 0.25rem;">
                                            <span>âš ï¸</span> æš‚æ— é¡¹ç›®ï¼Œè¯·å…ˆå‰å¾€ <a href="{{ url_for('manage_configs') }}">ç³»ç»Ÿé…ç½®</a> æ·»åŠ ã€‚
                                        </div>
                                    {% endif %}
                                </div>

                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label for="case_type" style="display:block; margin-bottom: 0.6rem; color: #334155; font-weight: 600; font-size: 0.95rem;">ç”¨ä¾‹ç±»å‹</label>
                                        <select name="case_type" id="case_type" class="input-modern" style="height: 50px; border-radius: 12px;">
                                            {% for ct in case_types %}
                                                <option value="{{ ct }}" {% if loop.first %}selected{% endif %}>{{ ct }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="apply_phase" style="display:block; margin-bottom: 0.6rem; color: #334155; font-weight: 600; font-size: 0.95rem;">é€‚ç”¨é˜¶æ®µ</label>
                                        <select name="apply_phase" id="apply_phase" class="input-modern" style="height: 50px; border-radius: 12px;">
                                            {% for ap in apply_phases %}
                                                <option value="{{ ap }}" {% if ap == 'åŠŸèƒ½æµ‹è¯•é˜¶æ®µ' %}selected{% elif loop.first and 'åŠŸèƒ½æµ‹è¯•é˜¶æ®µ' not in apply_phases %}selected{% endif %}>{{ ap }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 0.5rem; padding: 1.25rem; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--primary-color); position: relative; overflow: hidden;">
                                    <div style="position: absolute; right: -10px; bottom: -10px; font-size: 3rem; opacity: 0.05;">ğŸ’¡</div>
                                    <p style="margin: 0; font-size: 0.85rem; color: #475569; line-height: 1.6;">
                                        <strong>æç¤ºï¼š</strong>æ‰€é€‰é…ç½®å°†ç›´æ¥å½•å…¥è½¬æ¢åçš„æ–‡ä»¶ä¸­ã€‚å»ºè®®å…ˆä¸‹è½½æ¨¡æ¿ä»¥ç¡®ä¿ XMind èŠ‚ç‚¹å±‚çº§ç¬¦åˆè½¬æ¢è§„èŒƒã€‚
                                    </p>
                                </div>
                            </div>

                            <!-- Right Side: Dropzone -->
                            <div style="display: flex; flex-direction: column; gap: 1.75rem;">
                                <div class="upload-section">
                                    <label style="display:block; margin-bottom: 0.6rem; color: #334155; font-weight: 600; font-size: 0.95rem;">
                                        æ–‡ä»¶ä¸Šä¼  <span style="font-weight: normal; color: #94a3b8; font-size: 0.85rem;">(ä»…é™ .xmind)</span>
                                    </label>
                                    <label id="file-label" for="file" style="min-height: 180px; border: 2px dashed #cbd5e1; border-radius: 16px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; background: #fbfcfd;">
                                        <span class="upload-icon" style="font-size: 3.5rem; margin-bottom: 0.75rem; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05));">â˜ï¸</span>
                                        <span class="upload-text" id="file-display-name" style="font-size: 1.1rem; font-weight: 600; color: #475569;">ç‚¹å‡»æˆ–å°†æ–‡ä»¶æ‹–å…¥æ­¤å¤„</span>
                                        <span class="upload-hint" style="font-size: 0.85rem; color: #94a3b8; margin-top: 0.4rem;">æ›´å¿«æ·çš„è½¬æ¢ä½“éªŒ</span>
                                    </label>
                                    <input id="file" accept=".xmind" type="file" name="file" class="hidden" required/>
                                </div>

                                <input id="submit-btn" type="submit" value="ğŸš€ å¼€å§‹è½¬æ¢æ—…ç¨‹" class="btn-primary" 
                                    style="width: 100%; height: 56px; font-size: 1.15rem; border-radius: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 10px 20px -5px rgba(59, 130, 246, 0.3); transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);">
                            </div>
                        </div>
                    </form>
                </div>

                <!-- <div style="height: 3rem;"></div>

                <div style="height: 3rem;"></div>
 -->

                <!-- Guide Modal -->
                <div id="guideModal" class="modal" onclick="closeGuideModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <h2>ğŸ“ XMind ç¼–å†™è§„èŒƒæŒ‡å—</h2>
                            <button class="modal-close" onclick="closeGuideModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="guide-intro">
                                <p style="font-size: 1rem; color: var(--text-color); line-height: 1.6;">
                                    ä¸ºäº†ç¡®ä¿ XMind æ–‡ä»¶èƒ½å¤Ÿæ­£ç¡®è§£æä¸ºæµ‹è¯•ç”¨ä¾‹ï¼Œè¯·ä¸¥æ ¼éµå¾ªä»¥ä¸‹å±‚çº§ç»“æ„ã€‚
                                    æ¯ä¸ªå±‚çº§éƒ½æœ‰å…¶ç‰¹å®šçš„å«ä¹‰å’Œä½œç”¨ã€‚
                                </p>
                            </div>

                            <div class="guide-section" style="background: #f0f7ff; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; border: 1px solid #dbeafe; display: flex; align-items: center; justify-content: space-between;">
                                <div style="flex: 1;">
                                    <h3 style="margin: 0 0 0.5rem 0; border: none; padding: 0; color: #1e40af; display: flex; align-items: center; gap: 0.5rem;">
                                        ğŸš€ å¿«é€Ÿå¼€å§‹ <span style="font-size: 0.75rem; background: #3b82f6; color: white; padding: 2px 8px; border-radius: 20px;"></span>
                                    </h3>
                                    <p style="margin: 0 0 0.75rem 0; color: #3b82f6; font-size: 0.95rem;">ä¸‹è½½æœ€æ–°æ ‡å‡† XMind æ¨¡æ¿ï¼Œæ”¯æŒï¼š</p>
                                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                        <span style="font-size: 0.75rem; background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px; font-weight: 500;">â­ ä¼˜å…ˆçº§æ ‡è®°</span>
                                        <span style="font-size: 0.75rem; background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px; font-weight: 500;">ğŸ“ ç¬”è®°=å‰ç½®æ¡ä»¶</span>
                                        <span style="font-size: 0.75rem; background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 4px; font-weight: 500;">ğŸ“‘ æ ‡ç­¾=è‡ªåŠ¨åŒ–ç±»å‹</span>
                                    </div>
                                </div>
                                <a href="{{ url_for('static', path='guide/XMindæµ‹è¯•ç”¨ä¾‹æ¨¡æ¿.xmind') }}" download="XMindæµ‹è¯•ç”¨ä¾‹æ¨¡æ¿.xmind" class="btn-primary" style="background: #2563eb; padding: 0.75rem 1.5rem; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; border-radius: 10px; font-weight: 600;">
                                    ğŸ“¥ ä¸‹è½½å®˜æ–¹æ¨¡æ¿
                                </a>
                            </div>

                            <div class="guide-section">
                                <h3>ğŸ” å±‚çº§è¯´æ˜</h3>
                                <div class="guide-levels">
                                    <div class="level-item">
                                        <div class="level-badge level-1">ç¬¬ 0 å±‚</div>
                                        <div class="level-content">
                                            <h4>ä¸­å¿ƒä¸»é¢˜ - æµ‹è¯•æ¨¡å—</h4>
                                            <p>ä»£è¡¨æ•´ä¸ªæµ‹è¯•æ¨¡å—æˆ–é¡¹ç›®çš„åç§°ï¼Œä¾‹å¦‚ï¼š"ç”¨æˆ·ç®¡ç†æ¨¡å—"ã€"è®¢å•ç³»ç»Ÿæµ‹è¯•"</p>
                                            <div class="example">
                                                <strong>ç¤ºä¾‹ï¼š</strong><code>ç”µå•†å¹³å°-è´­ç‰©è½¦åŠŸèƒ½æµ‹è¯•</code>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="level-item">
                                        <div class="level-badge level-2">ç¬¬ 1 å±‚</div>
                                        <div class="level-content">
                                            <h4>æµ‹è¯•å¥—ä»¶ (Test Suite)</h4>
                                            <p>ä¸­å¿ƒä¸»é¢˜çš„ç¬¬ä¸€çº§å­èŠ‚ç‚¹ï¼Œç”¨äºç»„ç»‡ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹ï¼Œé€šå¸¸æŒ‰åŠŸèƒ½æ¨¡å—åˆ’åˆ†</p>
                                            <div class="example">
                                                <strong>ç¤ºä¾‹ï¼š</strong><code>æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦</code>ã€<code>ä¿®æ”¹è´­ç‰©è½¦æ•°é‡</code>ã€<code>åˆ é™¤è´­ç‰©è½¦å•†å“</code>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="level-item">
                                        <div class="level-badge level-3">ç¬¬ 2 å±‚</div>
                                        <div class="level-content">
                                            <h4>æµ‹è¯•ç”¨ä¾‹æ ‡é¢˜ (Test Case)</h4>
                                            <p>å…·ä½“çš„æµ‹è¯•åœºæ™¯æè¿°ï¼Œåº”è¯¥æ¸…æ™°è¯´æ˜è¦æµ‹è¯•ä»€ä¹ˆ</p>
                                            <div class="example">
                                                <strong>ç¤ºä¾‹ï¼š</strong><code>æ­£å¸¸æ·»åŠ å•ä¸ªå•†å“</code>ã€<code>æ·»åŠ å·²å”®ç½„å•†å“</code>ã€<code>æ·»åŠ è¶…è¿‡åº“å­˜æ•°é‡</code>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="level-item">
                                        <div class="level-badge level-4">ç¬¬ 3 å±‚</div>
                                        <div class="level-content">
                                            <h4>æµ‹è¯•æ­¥éª¤ (Test Step)</h4>
                                            <p>æ‰§è¡Œæµ‹è¯•çš„å…·ä½“æ“ä½œæ­¥éª¤ï¼Œåº”è¯¥è¯¦ç»†ä¸”å¯æ‰§è¡Œ</p>
                                            <div class="example">
                                                <strong>ç¤ºä¾‹ï¼š</strong><code>1. ç™»å½•ç³»ç»Ÿ</code>ã€<code>2. æµè§ˆå•†å“åˆ—è¡¨</code>ã€<code>3. ç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦"æŒ‰é’®</code>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="level-item">
                                        <div class="level-badge level-5">ç¬¬ 4 å±‚</div>
                                        <div class="level-content">
                                            <h4>é¢„æœŸç»“æœ (Expected Result)</h4>
                                            <p>æ¯ä¸ªæ­¥éª¤å¯¹åº”çš„é¢„æœŸç»“æœï¼Œç”¨äºéªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸</p>
                                            <div class="example">
                                                <strong>ç¤ºä¾‹ï¼š</strong><code>æ˜¾ç¤ºç™»å½•æˆåŠŸæç¤º</code>ã€<code>è´­ç‰©è½¦å›¾æ ‡æ˜¾ç¤ºæ•°é‡+1</code>ã€<code>å•†å“æˆåŠŸæ·»åŠ åˆ°è´­ç‰©è½¦åˆ—è¡¨</code>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="guide-section">
                                <h3>âœ… æœ€ä½³å®è·µ</h3>
                                <ul class="best-practices">
                                    <li><strong>ä¿æŒå±‚çº§æ¸…æ™°ï¼š</strong>ä¸¥æ ¼æŒ‰ç…§ 5 å±‚ç»“æ„ç»„ç»‡ï¼Œä¸è¦è·³å±‚æˆ–æ··ä¹±å±‚çº§</li>
                                    <li><strong>å‘½åè§„èŒƒï¼š</strong>ä½¿ç”¨æ¸…æ™°ã€ç®€æ´çš„ä¸­æ–‡æè¿°ï¼Œé¿å…ä½¿ç”¨ç‰¹æ®Šç¬¦å·</li>
                                    <li><strong>æ­¥éª¤è¯¦ç»†ï¼š</strong>æ¯ä¸ªæµ‹è¯•æ­¥éª¤åº”è¯¥è¶³å¤Ÿè¯¦ç»†ï¼Œè®©ä»»ä½•äººéƒ½èƒ½æ‰§è¡Œ</li>
                                    <li><strong>ç»“æœæ˜ç¡®ï¼š</strong>é¢„æœŸç»“æœè¦å…·ä½“å¯éªŒè¯ï¼Œé¿å…æ¨¡ç³Šæè¿°</li>
                                    <li><strong>é€»è¾‘å®Œæ•´ï¼š</strong>ç¡®ä¿æµ‹è¯•ç”¨ä¾‹è¦†ç›–æ­£å¸¸æµç¨‹å’Œå¼‚å¸¸æƒ…å†µ</li>
                                </ul>
                            </div>

                            <div class="guide-section">
                                <h3>âš ï¸ å¸¸è§é”™è¯¯</h3>
                                <ul class="common-errors">
                                    <li>âŒ å±‚çº§æ··ä¹±ï¼Œå°†æ­¥éª¤ç›´æ¥æ”¾åœ¨å¥—ä»¶ä¸‹</li>
                                    <li>âŒ ç¼ºå°‘é¢„æœŸç»“æœï¼Œåªæœ‰æ“ä½œæ­¥éª¤</li>
                                    <li>âŒ ç”¨ä¾‹æ ‡é¢˜è¿‡äºç¬¼ç»Ÿï¼Œæ— æ³•æ˜ç¡®æµ‹è¯•ç›®æ ‡</li>
                                    <li>âŒ æ­¥éª¤æè¿°ä¸æ¸…æ™°ï¼Œç¼ºå°‘å¿…è¦çš„æ“ä½œç»†èŠ‚</li>
                                </ul>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn-primary" onclick="closeGuideModal()">æˆ‘çŸ¥é“äº†</button>
                        </div>
                    </div>
                </div>

                <!-- Recent Records -->
                {% if records %}
                <div class="card table-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">æœ€è¿‘è½¬æ¢è®°å½•</h3>
                        <div class="search-filter-bar">
                            <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢æ–‡ä»¶å..." class="search-input" onkeyup="filterTable()">
                            <select id="projectFilter" class="filter-select" onchange="filterTable()">
                                <option value="">å…¨éƒ¨é¡¹ç›®</option>
                                {% for project in projects %}
                                    <option value="{{ project.name }}">{{ project.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <table class="modern-table recent-xminds">
                        <thead>
                        <tr style="font-size: 0.95rem;">
                            <th>æ‰€å±é¡¹ç›®</th>
                            <th style="width: 35%;">æ–‡ä»¶å</th>
                            <th>æ—¶é—´</th>
                            <th class="text-right">æ“ä½œ</th>
                        </tr>
                        </thead>
                        <tbody id="recordsTableBody">
                        {% for record in records %}
                            <tr data-project="{{ record.project_name }}" data-filename="{{ record.name }}">
                                <td>
                                    {% if record.project_id %}
                                        <a href="{{ url_for('project_detail', project_id=record.project_id) }}" class="project-link">{{ record.project_name }}</a>
                                    {% else %}
                                        <span class="text-muted">{{ record.project_name }}</span>
                                    {% endif %}
                                </td>
                                <td title="{{ record.name }}" class="table-cell-text"> {{ record.short_name }}</td>
                                <td class="time-cell">{{ record.create_on }}</td>
                                <td class="text-right">
                                    <div class="action-buttons" style="justify-content: flex-end;">
                                        <a href="{{ url_for('preview_record', record_id=record.id) }}" 
                                           class="btn-action btn-action-preview" 
                                           title="åœ¨çº¿é¢„è§ˆ">
                                            <span class="btn-icon">ğŸ‘ï¸</span>
                                            <span class="btn-text">é¢„è§ˆ</span>
                                        </a>
                                        {% if settings.ENABLE_ZENTAO %}
                                        <a href="{{ url_for('download_zentao_file',filename=record.name) }}" 
                                           class="btn-action" 
                                           title="ä¸‹è½½ç¦…é“ CSV">
                                            <span class="btn-icon">ğŸ“Š</span>
                                            <span class="btn-text">ç¦…é“</span>
                                        </a>
                                        {% endif %}
                                        {% if settings.ENABLE_TESTLINK %}
                                        <a href="{{ url_for('download_testlink_file',filename=record.name) }}" 
                                           class="btn-action" 
                                           title="ä¸‹è½½ TestLink XML">
                                            <span class="btn-icon">ğŸ“„</span>
                                            <span class="btn-text">TestLink</span>
                                        </a>
                                        {% endif %}
                                        <a href="{{ url_for('uploaded_file',filename=record.name) }}" 
                                           class="btn-action" 
                                           title="ä¸‹è½½ XMind åŸæ–‡ä»¶">
                                            <span class="btn-icon">ğŸ“¥</span>
                                            <span class="btn-text">XMind</span>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                    <div id="noResults" style="display: none; text-align: center; padding: 2rem; color: var(--text-muted);">
                        ğŸ˜• æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è®°å½•
                    </div>
                    <!-- Pagination Container -->
                    <div id="recordsTableBody-pagination"></div>
                </div>
                {% endif %}
                
            </div>
        </main>
    </div>

<script>
    // Open guide modal
    function openGuideModal() {
        const modal = document.getElementById("guideModal");
        modal.style.display = "flex";
        setTimeout(() => modal.classList.add("show"), 10);
        document.body.style.overflow = "hidden";
    }

    // Close guide modal
    function closeGuideModal() {
        const modal = document.getElementById("guideModal");
        modal.classList.remove("show");
        setTimeout(() => {
            modal.style.display = "none";
            document.body.style.overflow = "auto";
        }, 300);
    }

    const fileInput = document.getElementById("file");
    const fileLabel = document.getElementById("file-label");
    const displayName = document.getElementById("file-display-name");
    
    if (fileInput) {
        fileInput.addEventListener("change", function () {
            if (this.files.length > 0) {
                const fileName = this.files[0].name;
                displayName.innerText = "å·²é€‰æ‹©: " + fileName;
                displayName.style.color = "var(--primary-color)";
                
                fileLabel.style.borderColor = "var(--primary-color)";
                fileLabel.style.background = "#eff6ff";
                fileLabel.querySelector(".upload-icon").innerText = "âœ…";
            }
        });
    }

    if (fileLabel) {
        // Drag and drop functionality
        fileLabel.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileLabel.style.borderColor = "var(--primary-color)";
            fileLabel.style.background = "#eff6ff";
            fileLabel.style.transform = "translateY(-4px)";
            fileLabel.style.boxShadow = "0 10px 20px -5px rgba(59, 130, 246, 0.15)";
        });

        fileLabel.addEventListener('dragleave', (e) => {
            e.preventDefault();
            if (!fileInput.files.length) {
                fileLabel.style.borderColor = "#cbd5e1";
                fileLabel.style.background = "#fafafa";
                fileLabel.style.transform = "translateY(0)";
                fileLabel.style.boxShadow = "none";
            }
        });

        fileLabel.addEventListener('drop', (e) => {
            e.preventDefault();
            const files = e.dataTransfer.files;
            
            if (files.length > 0 && files[0].name.endsWith('.xmind')) {
                fileInput.files = files;
                // Manually trigger change event
                const event = new Event('change');
                fileInput.dispatchEvent(event);
            } else {
                showToast('è¯·ä¸Šä¼  .xmind æ ¼å¼çš„æ–‡ä»¶', 'warning');
                fileLabel.style.borderColor = "#cbd5e1";
                fileLabel.style.background = "#fafafa";
                fileLabel.style.transform = "translateY(0)";
            }
        });
    }

    function showToast(message, type = 'success') {
        let container = document.getElementById('toast-container');
        if (!container) {
            container = document.createElement('div');
            container.id = 'toast-container';
            document.body.appendChild(container);
        }
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        const icons = { success: 'âœ…', error: 'âŒ', warning: 'âš ï¸' };
        toast.innerHTML = `<span class="toast-icon">${icons[type]}</span><span class="toast-message">${message}</span>`;
        container.appendChild(toast);
        setTimeout(() => toast.classList.add('show'), 10);
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    // Close modal when pressing Escape key
    document.addEventListener("keydown", function(event) {
        if (event.key === "Escape") {
            closeGuideModal();
        }
    });

    // Initialize pagination after DOM loads
    let recordsPagination = null;
    document.addEventListener('DOMContentLoaded', function() {
        const tbody = document.getElementById('recordsTableBody');
        if (tbody && tbody.getElementsByTagName('tr').length > 0) {
            recordsPagination = new Pagination({
                tableId: 'recordsTableBody',
                itemsPerPage: 20
            });
            // Store in global instances for onclick handlers
            window.paginationInstances = window.paginationInstances || {};
            window.paginationInstances['recordsTableBody'] = recordsPagination;
        }
    });

    // Filter table function
    function filterTable() {
        const searchInput = document.getElementById("searchInput");
        const projectFilter = document.getElementById("projectFilter");
        const tbody = document.getElementById("recordsTableBody");
        const noResults = document.getElementById("noResults");
        
        if (!tbody) return;
        
        const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
        const projectTerm = projectFilter ? projectFilter.value : '';
        
        const rows = tbody.getElementsByTagName("tr");
        let visibleCount = 0;
        const visibleRows = [];
        
        for (let row of rows) {
            const project = row.getAttribute("data-project") || '';
            const filename = row.getAttribute("data-filename") || '';
            
            const matchesSearch = filename.toLowerCase().includes(searchTerm);
            const matchesProject = !projectTerm || project === projectTerm;
            
            if (matchesSearch && matchesProject) {
                row.style.display = "";
                visibleCount++;
                visibleRows.push(row);
            } else {
                row.style.display = "none";
            }
        }
        
        // Show/hide no results message
        if (noResults) {
            if (visibleCount === 0) {
                tbody.parentElement.style.display = "none";
                noResults.style.display = "block";
            } else {
                tbody.parentElement.style.display = "table";
                noResults.style.display = "none";
            }
        }
        
        // Refresh pagination with filtered results
        if (recordsPagination) {
            recordsPagination.refresh(visibleRows);
        }
    }

</script>

</body>
</html>
